function Fly(bool)
    local localplayer = game.Players.LocalPlayer
    local mouse = localplayer:GetMouse()
    
    if workspace:FindFirstChild("Core") then
        workspace.Core:Destroy()
    end
    
    local Core = Instance.new("Part")
    Core.Name = "Core"
    Core.Size = Vector3.new(0.05, 0.05, 0.05)
    
    spawn(function()
        Core.Parent = workspace
        local Weld = Instance.new("Weld", Core)
        Weld.Part0 = Core
        Weld.Part1 = localplayer.Character.LowerTorso
        Weld.C0 = CFrame.new(0, 0, 0)
    end)
    
    workspace:WaitForChild("Core")
    local torso = workspace.Core
    local flying = true
    local speed = 0
    local maxSpeed = 3
    local acceleration = 2
    local deceleration = 1
    
    local keys = {a = false, d = false, w = false, s = false}
    local e1
    local e2
    
    local function start()
        local pos = Instance.new("BodyPosition", torso)
        local gyro = Instance.new("BodyGyro", torso)
        
        pos.Name = "EPIXPOS"
        pos.maxForce = Vector3.new(math.huge, math.huge, math.huge)
        pos.position = torso.Position
        
        gyro.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        gyro.cframe = torso.CFrame
        
        repeat
            wait()
            localplayer.Character.Humanoid.PlatformStand = true
            
            if keys.w then
                if speed < maxSpeed then
                    speed = speed + acceleration
                end
            elseif keys.s then
                if speed > -maxSpeed then
                    speed = speed - acceleration
                end
            else
                if speed > 0 then
                    speed = math.max(0, speed - deceleration)
                elseif speed < 0 then
                    speed = math.min(0, speed + deceleration)
                end
            end
            
            local new = gyro.cframe - gyro.cframe.p + pos.position
            new = new + workspace.CurrentCamera.CoordinateFrame.lookVector * speed
            
            pos.position = new.p
            
            gyro.cframe = workspace.CurrentCamera.CoordinateFrame
        until not flying
        
        if gyro then
            gyro:Destroy()
        end
        
        if pos then
            pos:Destroy()
        end
        
        flying = false
        localplayer.Character.Humanoid.PlatformStand = false
    end
    
    e1 = mouse.KeyDown:Connect(function(key)
        if not torso or not torso.Parent then
            flying = false
            e1:Disconnect()
            e2:Disconnect()
            return
        end
        
        if key == "w" then
            keys.w = true
        elseif key == "s" then
            keys.s = true
        elseif key == "a" then
            keys.a = true
        elseif key == "d" then
            keys.d = true
        elseif key == "x" then
            if flying == true then
                flying = false
            else
                flying = true
                start()
            end
        end
    end)
    
    e2 = mouse.KeyUp:Connect(function(key)
        if key == "w" then
            keys.w = false
        elseif key == "s" then
            keys.s = false
        elseif key == "a" then
            keys.a = false
        elseif key == "d" then
            keys.d = false
        end
    end)
    
    local function stop()
    end
    
    if bool == true then
        start()
    else
        stop()
    end
end

return Fly
